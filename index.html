<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Potluck and Games üéÑ</title>
    
    <!-- Social Media Preview Tags -->
    <meta property="og:title" content="Christmas Potluck and Games üéÑ">
    <meta property="og:description" content="Join Javan & Khrystyna for a night of food, games, and holiday cheer! Check the details and sign up for the potluck.">
    <meta property="og:image" content="https://jwzy.github.io/christmas-party-2025/christmas%20flyer.webp">
    <meta property="og:url" content="https://jwzy.github.io/christmas-party-2025/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div class="gradient-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>
    <div class="container">
        <header>
            <h1>üéÑ Christmas Potluck and Games üéÑ</h1>
            <p>By Javan & Khrystyna</p>
        </header>
        <main>
            <section id="event-details">
                <h2>üìÖ Event Details</h2>
                <div class="details-grid">
                    <p><strong>üóì Date:</strong> Saturday, Dec 13 @ 7:00pm</p>
                    <p><strong>üìç Location:</strong> <a href="https://maps.app.goo.gl/7erDfpTLrVdHgYbV9" target="_blank">57 Wagon Trailway, Toronto</a></p>
                    <!-- <p><strong>üè† Hosts:</strong> Javan & Khrystyna</p> -->
                </div>
                
                <!-- <h3>üëç Good to Know</h3> -->
                <ul class="info-list">
                    <li><strong>Dress:</strong> Festively!</li>
                    <li><strong>Food & Drink:</strong> Potluck & BYOB</li>
                    <li><strong>Parking:</strong> Plenty of visitors parking around the complex</li>
                    <li><strong>Stay:</strong> You can crash overnight if needed (sleeping pads available)</li>
                </ul>
            </section>

            <section id="potluck">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 30px;">
                    <h2 style="margin: 0;">ü•ò Potluck List</h2>
                    <button id="open-modal-btn" class="btn" style="padding: 12px 24px; font-size: 1rem;">‚ûï Add your dish</button>
                </div>
                
                <div id="potluck-list" class="potluck-list-container">
                    <div class="loading-message">Loading tasty dishes...</div>
                </div>
            </section>

            <section id="guest-list" class="host-only">
                <h2>üìù Current Guest List</h2>
                
                <div class="details-grid">
                    <p><strong>Confirmed</strong>
                        <br>Viktor
                        <br>Devorah
                        <br>Xuey
                        <br>Kevin Tan
                        <br>James
                        <br>Kevin F
                        <br>Abe Train
                        <br>Rob Carman
                        <br>Peter
                        <br>Javan
                        <br>Khrystyna
                    </p>
                    <p><strong>Maybe</strong>
                        <br>Anqi
                        <br>Freddie
                        <br>Pat
                        <br>Sepehr
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Full Width Games Section -->
    <div class="games-container" style="width: 95%; max-width: 1400px; margin: 0 auto; padding-bottom: 60px;">
        <section id="games" class="host-only">
            <h2>üé≤ Games & Activities</h2>
            <p style="color: var(--text-lighter); font-size: 1.05rem; margin-bottom: 25px;">
                Compete for glory! Earn points individually or as temporary teams. Harder games = more points.
            </p>
            
            <div id="games-table-wrapper"></div>
        </section>
    </div>

    <div class="container">
    <!-- Footer could go here if added later -->
    <!-- Modal -->
    <div id="potluck-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            
            <div id="potluck-form-container">
                <h2 style="margin-top: 0; text-align: center;">üç≤ Bring a Dish</h2>
                <form id="potluck-form">
                    <div class="form-group">
                        <label for="guest-name">Your Name</label>
                        <input type="text" id="guest-name" name="name" required placeholder="e.g. Santa Claus">
                    </div>
                    <div class="form-group">
                        <label for="dish-name">What are you bringing?</label>
                        <input type="text" id="dish-name" name="dish" required placeholder="e.g. Grandma's Cookies">
                    </div>
                    <button type="submit" class="btn" style="width: 100%; margin-top: 10px;">Submit Dish</button>
                </form>
            </div>

            <div id="success-message" class="success-message" style="display: none;">
                <div class="success-progress-bar"></div>
                <h2 style="margin-top: 20px;">üéâ Submitted!</h2>
                <p>Deliciousness awaits.</p>
            </div>
        </div>
    </div>

    <!-- Admin Button -->
    <button id="admin-btn" title="Host Access">üîë</button>

    <script>
        // Admin Logic
        const adminBtn = document.getElementById('admin-btn');
        // SHA-256 hash of the password
        const HOST_HASH = "53d73c3111a333885bc5a57c546a57397ce57bb05170e9c02207dae4fc6f3fad";

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        if (adminBtn) {
            adminBtn.onclick = async function() {
                const password = prompt("Enter Host Password:");
                if (password) {
                    const hash = await sha256(password);
                    if (hash === HOST_HASH) {
                        document.querySelectorAll('.host-only').forEach(el => {
                            el.style.display = 'block';
                        });
                        adminBtn.style.display = 'none';
                        alert("Welcome Host! üçå");
                    } else {
                        alert("Incorrect password!");
                    }
                }
            };
        }

        // Games Table Logic
        document.addEventListener('DOMContentLoaded', () => {
             const gamesData = [
                ["1", "Guess Who? (Pt 1)", "1 person per sheet", "Social", "FFA", "5 Pts / Correct Guess"],
                ["2", "Squawk one, stack two", "Completion", "Physical", "2v2 pairs", "2 Pts Each"],
                ["3", "Holiday Charades", "2 prompts each, 60s to guess", "Social", "2 Teams", "1 Pt / Word Win"],
                ["4", "Balloon Waddle Rally", "First to finish wins", "Physical", "2v2 pairs", "2 Pts Each"],
                ["5", "Lift & Scoop", "60s", "Physical", "1v1 Head-to-Head", "3 Pts (Winner)"],
                ["6", "Rapid Fire Trivia", "10 questions", "Mental", "3 Teams", "1 Pt / Correct answer"],
                ["7", "Bow Battle Royale", "Last one standing", "Physical", "FFA (Last Standing)", "5 Pts (Winner)"],
                ["8", "Guess Who? (Pt 2)", "Reveal", "Social", "FFA", "Reveal"]
            ];
            
            // Trivia Questions Data
            const triviaQuestions = [
                { q: "What countries besides Canada celebrates Boxing Day?", a: "United Kingdom, Australia, New Zealand, South Africa, and Jamaica" },
                { q: "What's the name of the French-Canadian meat pie that's a Quebecois Christmas Eve staple?", a: "Tourti√®re" },
                { q: "Which country started the tradition of putting up a Christmas tree?", a: "Germany" },
                { q: "What song is this?", a: "Last Christmas" },
                { q: "Where was the music video for Mariah Carey's 'All I Want for Christmas Is You' filmed?", a: "New Jersey" },
                { q: "Who did Father Christmas wage war against, in 'The Father Christmas Letters'?", a: "The Goblins" },
                { q: "Which country can you face up to 5 years in jail for celebrating Christmas?", a: "Brunei" },
                { q: "Who owned the tarantula in 'Home Alone'?", a: "Buzz McCallister, Kevin's older brother" }
            ];

            // Render Card View for Mobile/Desktop
            const wrapper = document.getElementById("games-table-wrapper");
            if (wrapper) {
                let html = '<div class="game-cards">';
                gamesData.forEach(game => {
                    const [order, title, time, type, format, scoring] = game;
                    
                    // Special rendering for Trivia to include expandable questions
                    let extraContent = '';
                    if (title === "Rapid Fire Trivia") {
                        let questionsHtml = triviaQuestions.map((t, i) => 
                            `<details class="trivia-accordion-item">
                                <summary><strong>Q${i+1}:</strong> ${t.q}</summary>
                                <div class="trivia-answer"><em>A: ${t.a}</em></div>
                            </details>`
                        ).join('');
                        
                        extraContent = `<div class="trivia-accordion-container">${questionsHtml}</div>`;
                    }

                    html += `
                        <div class="game-card ${type.toLowerCase()}">
                            <div class="card-header">
                                <span class="game-order">#${order}</span>
                                <h3 class="game-title">${title}</h3>
                                <span class="game-type badge">${type}</span>
                            </div>
                            <div class="card-body">
                                <div class="card-row"><strong>üïí Time:</strong> ${time}</div>
                                <div class="card-row"><strong>üë• Format:</strong> ${format}</div>
                                <div class="card-row"><strong>üèÜ Scoring:</strong> ${scoring}</div>
                                ${extraContent}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                wrapper.innerHTML = html;
            }
        });

        // Modal Logic
        const modal = document.getElementById("potluck-modal");
        const btn = document.getElementById("open-modal-btn");
        const span = document.getElementsByClassName("close-modal")[0];
        const form = document.getElementById("potluck-form");
        const modalContent = document.querySelector('.modal-content');

        const scriptURL = 'https://script.google.com/macros/s/AKfycbysVdjS_g0Zlax7mxovFEQCuHsxTP77AIAURRhhmf4fgs3S0j0qiYlbd_5yghQulxRT/exec';

        function closeModal() {
            modalContent.classList.add('closing');
            setTimeout(() => {
                modal.style.display = "none";
                modalContent.classList.remove('closing');
                // Reset form state if needed
                const successMsg = document.getElementById('success-message');
                if (successMsg.style.display === 'block') {
                     document.getElementById('potluck-form-container').style.display = 'block';
                     successMsg.style.display = 'none';
                     form.reset();
                }
            }, 300); // Match animation duration
        }

        function openModal() {
             modal.style.display = "block";
        }

        function fetchPotluckList() {
            const container = document.getElementById('potluck-list');
            
            fetch(scriptURL)
                .then(response => response.json())
                .then(data => {
                    // Expecting data to be an array of objects
                    if (data && data.length > 0) {
                        let tableHTML = '<table class="potluck-table"><thead><tr><th>Guest</th><th>Dish</th></tr></thead><tbody>';
                        
                        data.forEach(row => {
                            // Only show rows that have a name and dish
                            if(row.name && row.dish) {
                                tableHTML += `<tr>
                                    <td>${row.name}</td>
                                    <td>${row.dish}</td>
                                </tr>`;
                            }
                        });
                        
                        tableHTML += '</tbody></table>';
                        container.innerHTML = tableHTML;
                    } else {
                        container.innerHTML = '<div class="loading-message">No dishes added yet! Be the first!</div>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching list:', error);
                    container.innerHTML = '<div class="error-message">Could not load the list. Refresh to try again.</div>';
                });
        }

        // Load list on page load
        document.addEventListener('DOMContentLoaded', fetchPotluckList);

        if (btn) {
            btn.onclick = openModal;
        }

        if (span) {
            span.onclick = closeModal;
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        if (form) {
            form.onsubmit = function(e) {
                e.preventDefault();
                
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalBtnText = submitBtn.innerText;
                submitBtn.innerText = "Sending...";
                submitBtn.disabled = true;

                const formData = new FormData(form);

                fetch(scriptURL, { method: 'POST', body: formData })
                    .then(response => {
                        const name = document.getElementById("guest-name").value;
                        const dish = document.getElementById("dish-name").value;
                        
                        // Switch to success message
                        document.getElementById('potluck-form-container').style.display = 'none';
                        const successMsg = document.getElementById('success-message');
                        successMsg.style.display = 'block';

                        // Trigger Confetti
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                        
                        // Reload the list to show the new entry immediately
                        const container = document.getElementById('potluck-list');
                        container.innerHTML = '<div class="loading-message">Updating list...</div>';
                        fetchPotluckList();

                        // Close modal after 3 seconds
                        setTimeout(() => {
                            closeModal();
                        }, 3000);
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        alert('Oops! Something went wrong. Please try again.');
                    })
                    .finally(() => {
                        submitBtn.innerText = originalBtnText;
                        submitBtn.disabled = false;
                    });
            }
        }
    </script>
</body>
</html>
